import{_ as s,c as a,o as n,Q as l}from"./chunks/framework.a5052463.js";const f=JSON.parse('{"title":"迁移指南","description":"迁移到viem较新版本的指南。","frontmatter":{"head":[["meta",{"property":"og:title","content":"迁移指南"}],["meta",{"name":"description","content":"迁移到viem较新版本的指南。"}],["meta",{"property":"og:description","content":"迁移到viem较新版本的指南。"}]]},"headers":[],"relativePath":"docs/migration-guide.md","filePath":"docs/migration-guide.md"}'),p={name:"docs/migration-guide.md"},o=l(`<h1 id="迁移指南" tabindex="-1">迁移指南 <a class="header-anchor" href="#迁移指南" aria-label="Permalink to &quot;迁移指南&quot;">​</a></h1><p>如果你之前使用较早版本的<code>viem</code>，你需要确认升级到下面列出的APIs：</p><h2 id="_1-x-x-重大变化" tabindex="-1">1.x.x 重大变化 <a class="header-anchor" href="#_1-x-x-重大变化" aria-label="Permalink to &quot;1.x.x 重大变化&quot;">​</a></h2><p>1.x.x版本只包括对事件日志解码行为进行非常小的改动，移除了ether.js钱包适配器。如果你没有直接使用这些APIs，你无需将你的代码更新到这个版本。</p><h3 id="移除etherswallettoaccount" tabindex="-1">移除<code>ethersWalletToAccount</code> <a class="header-anchor" href="#移除etherswallettoaccount" aria-label="Permalink to &quot;移除\`ethersWalletToAccount\`&quot;">​</a></h3><p><code>ethersWalletToAccount</code>适配器已经被移除了。</p><p>这个是适配器是在viem没有私钥和HD帐户被引入的。从0.2开始，viem提供了创建和导入<a href="https://viem.sh/docs/accounts/privateKey.html" target="_blank" rel="noreferrer">私钥</a>和<a href="https://viem.sh/docs/accounts/mnemonic.html" target="_blank" rel="noreferrer">HD账户</a>的所有功能。</p><p>如果你仍然需要它，你可以复制粘贴<a href="https://github.com/wagmi-dev/viem/blob/a9a71507032db896295fa1f3fa2dd6c2bdc85137/src/adapters/ethers.ts" target="_blank" rel="noreferrer">旧的实现</a>。</p><h3 id="logindex和transactionindex" tabindex="-1"><code>logIndex</code>和<code>transactionIndex</code> <a class="header-anchor" href="#logindex和transactionindex" aria-label="Permalink to &quot;\`logIndex\`和\`transactionIndex\`&quot;">​</a></h3><p><code>logIndex</code>和<code>transactionIndex</code>在<code>Log</code>中的返回现在用<code>number</code>替代<code>bigint</code>。</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki github-dark has-diff vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">log</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Log</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">...</span></span>
<span class="line diff remove"><span style="color:#E1E4E8;">  logIndex: </span><span style="color:#79B8FF;">1</span><span style="color:#F97583;">n</span><span style="color:#E1E4E8;">, </span></span>
<span class="line diff add"><span style="color:#E1E4E8;">  logIndex: </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">, </span></span>
<span class="line diff remove"><span style="color:#E1E4E8;">  transactionIndex: </span><span style="color:#79B8FF;">1</span><span style="color:#F97583;">n</span><span style="color:#E1E4E8;">, </span></span>
<span class="line diff add"><span style="color:#E1E4E8;">  transactionIndex: </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">, </span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">...</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light has-diff vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">log</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Log</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">...</span></span>
<span class="line diff remove"><span style="color:#24292E;">  logIndex: </span><span style="color:#005CC5;">1</span><span style="color:#D73A49;">n</span><span style="color:#24292E;">, </span></span>
<span class="line diff add"><span style="color:#24292E;">  logIndex: </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">, </span></span>
<span class="line diff remove"><span style="color:#24292E;">  transactionIndex: </span><span style="color:#005CC5;">1</span><span style="color:#D73A49;">n</span><span style="color:#24292E;">, </span></span>
<span class="line diff add"><span style="color:#24292E;">  transactionIndex: </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">, </span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">...</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><h3 id="次要的-decodeeventlog行为修改" tabindex="-1">次要的：<code>decodeEventLog</code>行为修改 <a class="header-anchor" href="#次要的-decodeeventlog行为修改" aria-label="Permalink to &quot;次要的：\`decodeEventLog\`行为修改&quot;">​</a></h3><p><code>decodeEventLog</code>不再尝试部分解码事件。如果日志不符合ABI(indexed/non-indexed参数与 topics/data不匹配)，它将会抛出错误。</p><p>例如，下面的日志将会抛出错误，因为non-<code>indexed</code>参数与<code>data</code>的长度不匹配。</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki github-dark has-highlighted-lines vp-code-dark"><code><span class="line"><span style="color:#B392F0;">decodeEventLog</span><span style="color:#E1E4E8;">({</span></span>
<span class="line highlighted"><span style="color:#E1E4E8;">  abi: </span><span style="color:#B392F0;">parseAbi</span><span style="color:#E1E4E8;">([</span><span style="color:#9ECBFF;">&#39;event Transfer(address indexed, address, uint256)&#39;</span><span style="color:#E1E4E8;">]),</span></span>
<span class="line highlighted"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// \`data\`应该是64字节的, 但它只是32字节的。</span></span>
<span class="line highlighted"><span style="color:#E1E4E8;">  data: </span><span style="color:#9ECBFF;">&#39;0x0000000000000000000000000000000000000000000000000000000000000001&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">  topics: [</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&#39;0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&#39;0x000000000000000000000000f39fd6e51aad88f6f4ce6ab8827279cfffb92266&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  ]</span></span>
<span class="line"><span style="color:#E1E4E8;">})</span></span></code></pre><pre class="shiki github-light has-highlighted-lines vp-code-light"><code><span class="line"><span style="color:#6F42C1;">decodeEventLog</span><span style="color:#24292E;">({</span></span>
<span class="line highlighted"><span style="color:#24292E;">  abi: </span><span style="color:#6F42C1;">parseAbi</span><span style="color:#24292E;">([</span><span style="color:#032F62;">&#39;event Transfer(address indexed, address, uint256)&#39;</span><span style="color:#24292E;">]),</span></span>
<span class="line highlighted"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// \`data\`应该是64字节的, 但它只是32字节的。</span></span>
<span class="line highlighted"><span style="color:#24292E;">  data: </span><span style="color:#032F62;">&#39;0x0000000000000000000000000000000000000000000000000000000000000001&#39;</span></span>
<span class="line"><span style="color:#24292E;">  topics: [</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&#39;0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&#39;0x000000000000000000000000f39fd6e51aad88f6f4ce6ab8827279cfffb92266&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  ]</span></span>
<span class="line"><span style="color:#24292E;">})</span></span></code></pre></div><p>以前，上面的代码只会解码<code>indexed</code>参数。</p><p>如果你想解码部分事件日志（以前的方式），你可以是用<code>strct</code>模式：</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki github-dark has-diff vp-code-dark"><code><span class="line"><span style="color:#B392F0;">decodeEventLog</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">  abi: </span><span style="color:#B392F0;">parseAbi</span><span style="color:#E1E4E8;">([</span><span style="color:#9ECBFF;">&#39;event Transfer(address indexed, address, uint256)&#39;</span><span style="color:#E1E4E8;">]),</span></span>
<span class="line"><span style="color:#E1E4E8;">  data: </span><span style="color:#9ECBFF;">&#39;0x0000000000000000000000000000000000000000000000000000000000000001&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">  topics: [</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&#39;0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&#39;0x000000000000000000000000f39fd6e51aad88f6f4ce6ab8827279cfffb92266&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  ],</span></span>
<span class="line diff add"><span style="color:#E1E4E8;">  strict: </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;">})</span></span></code></pre><pre class="shiki github-light has-diff vp-code-light"><code><span class="line"><span style="color:#6F42C1;">decodeEventLog</span><span style="color:#24292E;">({</span></span>
<span class="line"><span style="color:#24292E;">  abi: </span><span style="color:#6F42C1;">parseAbi</span><span style="color:#24292E;">([</span><span style="color:#032F62;">&#39;event Transfer(address indexed, address, uint256)&#39;</span><span style="color:#24292E;">]),</span></span>
<span class="line"><span style="color:#24292E;">  data: </span><span style="color:#032F62;">&#39;0x0000000000000000000000000000000000000000000000000000000000000001&#39;</span></span>
<span class="line"><span style="color:#24292E;">  topics: [</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&#39;0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&#39;0x000000000000000000000000f39fd6e51aad88f6f4ce6ab8827279cfffb92266&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  ],</span></span>
<span class="line diff add"><span style="color:#24292E;">  strict: </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;">})</span></span></code></pre></div><h2 id="_0-3-x-重大改变" tabindex="-1">0.3.x 重大改变 <a class="header-anchor" href="#_0-3-x-重大改变" aria-label="Permalink to &quot;0.3.x 重大改变&quot;">​</a></h2><p>0.3.x版本只包含几个关于RPC错误的重大更改。如果你没有直接使用下面列出的APIs，你不用在这个版本更新代码.</p><h3 id="将requesterror重命名为rpcerror" tabindex="-1">将<code>RequestError</code>重命名为<code>RpcError</code> <a class="header-anchor" href="#将requesterror重命名为rpcerror" aria-label="Permalink to &quot;将\`RequestError\`重命名为\`RpcError\`&quot;">​</a></h3><p>为了更加明确，我们将<code>RequestError</code>重命名为<code>RpcError</code>。</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki github-dark has-diff vp-code-dark"><code><span class="line diff remove"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { RequestError } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;viem&#39;</span><span style="color:#E1E4E8;">  </span></span>
<span class="line diff add"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { RpcError } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;viem&#39;</span><span style="color:#E1E4E8;">  </span></span>
<span class="line"></span>
<span class="line diff remove"><span style="color:#F97583;">throw</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RequestError</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Error</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;An error occurred.&#39;</span><span style="color:#E1E4E8;">))  </span></span>
<span class="line diff add"><span style="color:#F97583;">throw</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RpcError</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Error</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;An error occurred.&#39;</span><span style="color:#E1E4E8;">))  </span></span></code></pre><pre class="shiki github-light has-diff vp-code-light"><code><span class="line diff remove"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { RequestError } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;viem&#39;</span><span style="color:#24292E;">  </span></span>
<span class="line diff add"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { RpcError } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;viem&#39;</span><span style="color:#24292E;">  </span></span>
<span class="line"></span>
<span class="line diff remove"><span style="color:#D73A49;">throw</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RequestError</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Error</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;An error occurred.&#39;</span><span style="color:#24292E;">))  </span></span>
<span class="line diff add"><span style="color:#D73A49;">throw</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RpcError</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Error</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;An error occurred.&#39;</span><span style="color:#24292E;">))  </span></span></code></pre></div><h3 id="移除rpcrequesterror" tabindex="-1">移除<code>RpcRequestError</code> <a class="header-anchor" href="#移除rpcrequesterror" aria-label="Permalink to &quot;移除\`RpcRequestError\`&quot;">​</a></h3><p><code>RpcRequestError</code>被移除了，使用<code>RpcError</code>来代替它。</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki github-dark has-diff vp-code-dark"><code><span class="line diff remove"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { RpcRequestError } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;viem&#39;</span><span style="color:#E1E4E8;"> </span></span>
<span class="line diff add"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { RpcError } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;viem&#39;</span><span style="color:#E1E4E8;">  </span></span>
<span class="line"></span>
<span class="line diff remove"><span style="color:#F97583;">throw</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RpcRequestError</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Error</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;An error occurred.&#39;</span><span style="color:#E1E4E8;">)) </span></span>
<span class="line diff add"><span style="color:#F97583;">throw</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RpcError</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Error</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;An error occurred.&#39;</span><span style="color:#E1E4E8;">)) </span></span></code></pre><pre class="shiki github-light has-diff vp-code-light"><code><span class="line diff remove"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { RpcRequestError } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;viem&#39;</span><span style="color:#24292E;"> </span></span>
<span class="line diff add"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { RpcError } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;viem&#39;</span><span style="color:#24292E;">  </span></span>
<span class="line"></span>
<span class="line diff remove"><span style="color:#D73A49;">throw</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RpcRequestError</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Error</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;An error occurred.&#39;</span><span style="color:#24292E;">)) </span></span>
<span class="line diff add"><span style="color:#D73A49;">throw</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RpcError</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Error</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;An error occurred.&#39;</span><span style="color:#24292E;">)) </span></span></code></pre></div><h3 id="将rpcerror重命名为rpcrequesterror" tabindex="-1">将<code>RpcError</code>重命名为<code>RpcRequestError</code> <a class="header-anchor" href="#将rpcerror重命名为rpcrequesterror" aria-label="Permalink to &quot;将\`RpcError\`重命名为\`RpcRequestError\`&quot;">​</a></h3><p>为提高一致性，<code>RpcError</code>被重命名为<code>RpcRequestError</code>。</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki github-dark has-diff vp-code-dark"><code><span class="line diff remove"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { RpcError } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;viem&#39;</span><span style="color:#E1E4E8;"> </span></span>
<span class="line diff add"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { RpcRequestError } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;viem&#39;</span><span style="color:#E1E4E8;">  </span></span>
<span class="line"></span>
<span class="line diff remove"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">err</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RpcError</span><span style="color:#E1E4E8;">({ </span></span>
<span class="line diff add"><span style="color:#E1E4E8;">const err </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RpcRequestError</span><span style="color:#E1E4E8;">({  </span></span>
<span class="line"><span style="color:#E1E4E8;">  body: { foo: </span><span style="color:#9ECBFF;">&#39;bar&#39;</span><span style="color:#E1E4E8;"> },</span></span>
<span class="line"><span style="color:#E1E4E8;">  error: { code: </span><span style="color:#79B8FF;">420</span><span style="color:#E1E4E8;">, message: </span><span style="color:#9ECBFF;">&#39;Error&#39;</span><span style="color:#E1E4E8;"> },</span></span>
<span class="line"><span style="color:#E1E4E8;">  url: </span><span style="color:#9ECBFF;">&#39;https://example-rpc.com&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">})</span></span></code></pre><pre class="shiki github-light has-diff vp-code-light"><code><span class="line diff remove"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { RpcError } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;viem&#39;</span><span style="color:#24292E;"> </span></span>
<span class="line diff add"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { RpcRequestError } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;viem&#39;</span><span style="color:#24292E;">  </span></span>
<span class="line"></span>
<span class="line diff remove"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">err</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RpcError</span><span style="color:#24292E;">({ </span></span>
<span class="line diff add"><span style="color:#24292E;">const err </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RpcRequestError</span><span style="color:#24292E;">({  </span></span>
<span class="line"><span style="color:#24292E;">  body: { foo: </span><span style="color:#032F62;">&#39;bar&#39;</span><span style="color:#24292E;"> },</span></span>
<span class="line"><span style="color:#24292E;">  error: { code: </span><span style="color:#005CC5;">420</span><span style="color:#24292E;">, message: </span><span style="color:#032F62;">&#39;Error&#39;</span><span style="color:#24292E;"> },</span></span>
<span class="line"><span style="color:#24292E;">  url: </span><span style="color:#032F62;">&#39;https://example-rpc.com&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">})</span></span></code></pre></div><h2 id="_0-2-x-重大改变" tabindex="-1">0.2.x 重大改变 <a class="header-anchor" href="#_0-2-x-重大改变" aria-label="Permalink to &quot;0.2.x 重大改变&quot;">​</a></h2><h3 id="sendtransaction-writecontract-deploycontract这些方法需要chain" tabindex="-1"><code>sendTransaction</code>, <code>writeContract</code>, <code>deployContract</code>这些方法需要<code>chain</code> <a class="header-anchor" href="#sendtransaction-writecontract-deploycontract这些方法需要chain" aria-label="Permalink to &quot;\`sendTransaction\`, \`writeContract\`, \`deployContract\`这些方法需要\`chain\`&quot;">​</a></h3><p><code>sendTransaction</code>, <code>writeContract</code>, <code>deployContract</code>的操作，需要需要<code>chain</code>。</p><p>你可以再Client加入Chain：</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki github-dark has-diff vp-code-dark"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { createWalletClient, custom, getAccount } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;viem&#39;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { mainnet } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;viem/chains&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">walletClient</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">createWalletClient</span><span style="color:#E1E4E8;">({</span></span>
<span class="line diff add"><span style="color:#E1E4E8;">  chain: mainnet, </span></span>
<span class="line"><span style="color:#E1E4E8;">  transport: </span><span style="color:#B392F0;">custom</span><span style="color:#E1E4E8;">(window.ethereum)</span></span>
<span class="line"><span style="color:#E1E4E8;">})</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">account</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getAccount</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">hash</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> walletClient.</span><span style="color:#B392F0;">sendTransaction</span><span style="color:#E1E4E8;">({ </span></span>
<span class="line"><span style="color:#E1E4E8;">  account,</span></span>
<span class="line"><span style="color:#E1E4E8;">  to: </span><span style="color:#9ECBFF;">&#39;0x70997970c51812dc3a010c7d01b50e0d17dc79c8&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  value: </span><span style="color:#79B8FF;">1000000000000000000</span><span style="color:#F97583;">n</span></span>
<span class="line"><span style="color:#E1E4E8;">})</span></span></code></pre><pre class="shiki github-light has-diff vp-code-light"><code><span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { createWalletClient, custom, getAccount } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;viem&#39;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { mainnet } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;viem/chains&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">walletClient</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">createWalletClient</span><span style="color:#24292E;">({</span></span>
<span class="line diff add"><span style="color:#24292E;">  chain: mainnet, </span></span>
<span class="line"><span style="color:#24292E;">  transport: </span><span style="color:#6F42C1;">custom</span><span style="color:#24292E;">(window.ethereum)</span></span>
<span class="line"><span style="color:#24292E;">})</span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">account</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getAccount</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">hash</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">await</span><span style="color:#24292E;"> walletClient.</span><span style="color:#6F42C1;">sendTransaction</span><span style="color:#24292E;">({ </span></span>
<span class="line"><span style="color:#24292E;">  account,</span></span>
<span class="line"><span style="color:#24292E;">  to: </span><span style="color:#032F62;">&#39;0x70997970c51812dc3a010c7d01b50e0d17dc79c8&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  value: </span><span style="color:#005CC5;">1000000000000000000</span><span style="color:#D73A49;">n</span></span>
<span class="line"><span style="color:#24292E;">})</span></span></code></pre></div><p>或者你可以直接在方法中传入Chain：</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki github-dark has-diff vp-code-dark"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { createWalletClient, custom, getAccount } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;viem&#39;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { mainnet } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;viem/chains&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">walletClient</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">createWalletClient</span><span style="color:#E1E4E8;">({</span></span>
<span class="line diff remove"><span style="color:#E1E4E8;">  chain: mainnet, </span></span>
<span class="line"><span style="color:#E1E4E8;">  transport: </span><span style="color:#B392F0;">custom</span><span style="color:#E1E4E8;">(window.ethereum)</span></span>
<span class="line"><span style="color:#E1E4E8;">})</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">account</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getAccount</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">hash</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> walletClient.</span><span style="color:#B392F0;">sendTransaction</span><span style="color:#E1E4E8;">({ </span></span>
<span class="line"><span style="color:#E1E4E8;">  account,</span></span>
<span class="line diff add"><span style="color:#E1E4E8;">  chain: mainnet, </span></span>
<span class="line"><span style="color:#E1E4E8;">  to: </span><span style="color:#9ECBFF;">&#39;0x70997970c51812dc3a010c7d01b50e0d17dc79c8&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  value: </span><span style="color:#79B8FF;">1000000000000000000</span><span style="color:#F97583;">n</span></span>
<span class="line"><span style="color:#E1E4E8;">})</span></span></code></pre><pre class="shiki github-light has-diff vp-code-light"><code><span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { createWalletClient, custom, getAccount } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;viem&#39;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { mainnet } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;viem/chains&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">walletClient</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">createWalletClient</span><span style="color:#24292E;">({</span></span>
<span class="line diff remove"><span style="color:#24292E;">  chain: mainnet, </span></span>
<span class="line"><span style="color:#24292E;">  transport: </span><span style="color:#6F42C1;">custom</span><span style="color:#24292E;">(window.ethereum)</span></span>
<span class="line"><span style="color:#24292E;">})</span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">account</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getAccount</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">hash</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">await</span><span style="color:#24292E;"> walletClient.</span><span style="color:#6F42C1;">sendTransaction</span><span style="color:#24292E;">({ </span></span>
<span class="line"><span style="color:#24292E;">  account,</span></span>
<span class="line diff add"><span style="color:#24292E;">  chain: mainnet, </span></span>
<span class="line"><span style="color:#24292E;">  to: </span><span style="color:#032F62;">&#39;0x70997970c51812dc3a010c7d01b50e0d17dc79c8&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  value: </span><span style="color:#005CC5;">1000000000000000000</span><span style="color:#D73A49;">n</span></span>
<span class="line"><span style="color:#24292E;">})</span></span></code></pre></div><h3 id="recoveraddress-recovermessageaddress-verifymessage这些方法现在是异步的" tabindex="-1"><code>recoverAddress</code>, <code>recoverMessageAddress</code>, <code>verifyMessage</code>这些方法现在是异步的 <a class="header-anchor" href="#recoveraddress-recovermessageaddress-verifymessage这些方法现在是异步的" aria-label="Permalink to &quot;\`recoverAddress\`, \`recoverMessageAddress\`, \`verifyMessage\`这些方法现在是异步的&quot;">​</a></h3><p>以下函数现在是<code>async</code>函数而不是同步函数：</p><ul><li><code>recoverAddress</code></li><li><code>recoverMessageAddress</code></li><li><code>verifyMessage</code></li></ul><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki github-dark has-diff vp-code-dark"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { recoverMessageAddress } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;viem&#39;</span></span>
<span class="line"></span>
<span class="line diff remove"><span style="color:#B392F0;">recoverMessageAddress</span><span style="color:#E1E4E8;">({ message: </span><span style="color:#9ECBFF;">&#39;hello world&#39;</span><span style="color:#E1E4E8;">, signature: </span><span style="color:#9ECBFF;">&#39;0x...&#39;</span><span style="color:#E1E4E8;"> }) </span></span>
<span class="line diff add"><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">recoverMessageAddress</span><span style="color:#E1E4E8;">({ message: </span><span style="color:#9ECBFF;">&#39;hello world&#39;</span><span style="color:#E1E4E8;">, signature: </span><span style="color:#9ECBFF;">&#39;0x...&#39;</span><span style="color:#E1E4E8;"> }) </span></span></code></pre><pre class="shiki github-light has-diff vp-code-light"><code><span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { recoverMessageAddress } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;viem&#39;</span></span>
<span class="line"></span>
<span class="line diff remove"><span style="color:#6F42C1;">recoverMessageAddress</span><span style="color:#24292E;">({ message: </span><span style="color:#032F62;">&#39;hello world&#39;</span><span style="color:#24292E;">, signature: </span><span style="color:#032F62;">&#39;0x...&#39;</span><span style="color:#24292E;"> }) </span></span>
<span class="line diff add"><span style="color:#D73A49;">await</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">recoverMessageAddress</span><span style="color:#24292E;">({ message: </span><span style="color:#032F62;">&#39;hello world&#39;</span><span style="color:#24292E;">, signature: </span><span style="color:#032F62;">&#39;0x...&#39;</span><span style="color:#24292E;"> }) </span></span></code></pre></div><h3 id="assertchain-removed-from-sendtransaction" tabindex="-1"><code>assertChain</code> removed from <code>sendTransaction</code> <a class="header-anchor" href="#assertchain-removed-from-sendtransaction" aria-label="Permalink to &quot;\`assertChain\` removed from \`sendTransaction\`&quot;">​</a></h3><p>在<code>sendTransaction</code>, <code>writeContract</code> &amp; <code>deployContract</code>中移除<code>assertChain</code>参数。如果你希望绕过链检查（除非出于测试目的，否则不推荐），可以通过传入<code>chain: null</code>：</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki github-dark has-diff vp-code-dark"><code><span class="line"><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> walletClient.</span><span style="color:#B392F0;">sendTransaction</span><span style="color:#E1E4E8;">({</span></span>
<span class="line diff remove"><span style="color:#E1E4E8;">  assertChain: </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">, </span></span>
<span class="line diff add"><span style="color:#E1E4E8;">  chain: </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">, </span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">...</span></span>
<span class="line"><span style="color:#E1E4E8;">})</span></span></code></pre><pre class="shiki github-light has-diff vp-code-light"><code><span class="line"><span style="color:#D73A49;">await</span><span style="color:#24292E;"> walletClient.</span><span style="color:#6F42C1;">sendTransaction</span><span style="color:#24292E;">({</span></span>
<span class="line diff remove"><span style="color:#24292E;">  assertChain: </span><span style="color:#005CC5;">false</span><span style="color:#24292E;">, </span></span>
<span class="line diff add"><span style="color:#24292E;">  chain: </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">, </span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">...</span></span>
<span class="line"><span style="color:#24292E;">})</span></span></code></pre></div><h3 id="getaccount被移除" tabindex="-1"><code>getAccount</code>被移除 <a class="header-anchor" href="#getaccount被移除" aria-label="Permalink to &quot;\`getAccount\`被移除&quot;">​</a></h3><p>移除<code>getAccount</code>函数.</p><h4 id="如果是json-rpc账户-直接用它自己的地址。" tabindex="-1">如果是JSON-RPC账户,直接用它自己的地址。 <a class="header-anchor" href="#如果是json-rpc账户-直接用它自己的地址。" aria-label="Permalink to &quot;如果是JSON-RPC账户,直接用它自己的地址。&quot;">​</a></h4><p>现在你可以在<code>account</code>选项上直接传入地址。</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki github-dark has-diff vp-code-dark"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { createWalletClient, custom } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;viem&#39;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { mainnet } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;viem/chains&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">address</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;0xFBA3912Ca04dd458c843e2EE08967fC04f3579c2&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">client</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">createWalletClient</span><span style="color:#E1E4E8;">({</span></span>
<span class="line diff remove"><span style="color:#E1E4E8;">  account: </span><span style="color:#B392F0;">getAccount</span><span style="color:#E1E4E8;">(address), </span></span>
<span class="line diff add"><span style="color:#E1E4E8;">  account: address, </span></span>
<span class="line"><span style="color:#E1E4E8;">  chain: mainnet,</span></span>
<span class="line"><span style="color:#E1E4E8;">  transport: </span><span style="color:#B392F0;">custom</span><span style="color:#E1E4E8;">(window.ethereum)</span></span>
<span class="line"><span style="color:#E1E4E8;">})</span></span></code></pre><pre class="shiki github-light has-diff vp-code-light"><code><span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { createWalletClient, custom } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;viem&#39;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { mainnet } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;viem/chains&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">address</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;0xFBA3912Ca04dd458c843e2EE08967fC04f3579c2&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">client</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">createWalletClient</span><span style="color:#24292E;">({</span></span>
<span class="line diff remove"><span style="color:#24292E;">  account: </span><span style="color:#6F42C1;">getAccount</span><span style="color:#24292E;">(address), </span></span>
<span class="line diff add"><span style="color:#24292E;">  account: address, </span></span>
<span class="line"><span style="color:#24292E;">  chain: mainnet,</span></span>
<span class="line"><span style="color:#24292E;">  transport: </span><span style="color:#6F42C1;">custom</span><span style="color:#24292E;">(window.ethereum)</span></span>
<span class="line"><span style="color:#24292E;">})</span></span></code></pre></div><h4 id="如果是以太坊钱包适配器-使用etherswallettoaccount" tabindex="-1">如果是以太坊钱包适配器，使用<code>ethersWalletToAccount</code>. <a class="header-anchor" href="#如果是以太坊钱包适配器-使用etherswallettoaccount" aria-label="Permalink to &quot;如果是以太坊钱包适配器，使用\`ethersWalletToAccount\`.&quot;">​</a></h4><p>如果你一起拿使用以太坊钱包适配器，你可以使用<code>ethersWalletToAccount</code>函数。</p><blockquote><p>注意: viem 0.2.0 现在蛋<a href="/docs/accounts/privateKey.html">私钥</a>和<a href="/docs/accounts/mnemonic.html">助记词账户</a>的实现。可能你现在不需要适配器了，适配器可能在将来的版本移除。</p></blockquote><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki github-dark has-diff vp-code-dark"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { createWalletClient, custom } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;viem&#39;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { mainnet } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;viem/chains&#39;</span></span>
<span class="line diff remove"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { getAccount } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;viem/ethers&#39;</span><span style="color:#E1E4E8;"> </span></span>
<span class="line diff add"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { ethersWalletToAccount } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;viem/ethers&#39;</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { Wallet } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;ethers&#39;</span></span>
<span class="line"></span>
<span class="line diff remove"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">account</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getAccount</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Wallet</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;0x...&#39;</span><span style="color:#E1E4E8;">)) </span></span>
<span class="line diff add"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">account</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ethersWalletToAccount</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Wallet</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;0x...&#39;</span><span style="color:#E1E4E8;">)) </span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">client</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">createWalletClient</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">  account,</span></span>
<span class="line"><span style="color:#E1E4E8;">  chain: mainnet,</span></span>
<span class="line"><span style="color:#E1E4E8;">  transport: </span><span style="color:#B392F0;">custom</span><span style="color:#E1E4E8;">(window.ethereum)</span></span>
<span class="line"><span style="color:#E1E4E8;">})</span></span></code></pre><pre class="shiki github-light has-diff vp-code-light"><code><span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { createWalletClient, custom } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;viem&#39;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { mainnet } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;viem/chains&#39;</span></span>
<span class="line diff remove"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { getAccount } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;viem/ethers&#39;</span><span style="color:#24292E;"> </span></span>
<span class="line diff add"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { ethersWalletToAccount } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;viem/ethers&#39;</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { Wallet } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;ethers&#39;</span></span>
<span class="line"></span>
<span class="line diff remove"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">account</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getAccount</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Wallet</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;0x...&#39;</span><span style="color:#24292E;">)) </span></span>
<span class="line diff add"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">account</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ethersWalletToAccount</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Wallet</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;0x...&#39;</span><span style="color:#24292E;">)) </span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">client</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">createWalletClient</span><span style="color:#24292E;">({</span></span>
<span class="line"><span style="color:#24292E;">  account,</span></span>
<span class="line"><span style="color:#24292E;">  chain: mainnet,</span></span>
<span class="line"><span style="color:#24292E;">  transport: </span><span style="color:#6F42C1;">custom</span><span style="color:#24292E;">(window.ethereum)</span></span>
<span class="line"><span style="color:#24292E;">})</span></span></code></pre></div><h4 id="对于本地账户-使用toaccount。" tabindex="-1">对于本地账户, 使用<code>toAccount</code>。 <a class="header-anchor" href="#对于本地账户-使用toaccount。" aria-label="Permalink to &quot;对于本地账户, 使用\`toAccount\`。&quot;">​</a></h4><p>如果你使用自定义签名实现，可以使用<code>toAccount</code>方法。</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki github-dark has-diff vp-code-dark"><code><span class="line diff remove"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { createWalletClient, http, getAccount } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;viem&#39;</span><span style="color:#E1E4E8;"> </span></span>
<span class="line diff add"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { createWalletClient, http } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;viem&#39;</span><span style="color:#E1E4E8;"> </span></span>
<span class="line diff add"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { toAccount } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;viem/accounts&#39;</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { mainnet } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;viem/chains&#39;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { getAddress, signMessage, signTransaction } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;./sign-utils&#39;</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">privateKey</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;0x...&#39;</span><span style="color:#E1E4E8;"> </span></span>
<span class="line diff remove"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">account</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getAccount</span><span style="color:#E1E4E8;">({ </span></span>
<span class="line diff add"><span style="color:#E1E4E8;">const account </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">toAccount</span><span style="color:#E1E4E8;">({ </span></span>
<span class="line"><span style="color:#E1E4E8;">  address: </span><span style="color:#B392F0;">getAddress</span><span style="color:#E1E4E8;">(privateKey),</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">signMessage</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">message</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">signMessage</span><span style="color:#E1E4E8;">(message, privateKey)</span></span>
<span class="line"><span style="color:#E1E4E8;">  },</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">signTransaction</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">transaction</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">signTransaction</span><span style="color:#E1E4E8;">(transaction, privateKey)</span></span>
<span class="line"><span style="color:#E1E4E8;">  },</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">signTypedData</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">typedData</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">signTypedData</span><span style="color:#E1E4E8;">(typedData, privateKey)</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">const client </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">createWalletClient</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">  account,</span></span>
<span class="line"><span style="color:#E1E4E8;">  chain: mainnet,</span></span>
<span class="line"><span style="color:#E1E4E8;">  transport: </span><span style="color:#B392F0;">http</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">})</span></span></code></pre><pre class="shiki github-light has-diff vp-code-light"><code><span class="line diff remove"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { createWalletClient, http, getAccount } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;viem&#39;</span><span style="color:#24292E;"> </span></span>
<span class="line diff add"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { createWalletClient, http } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;viem&#39;</span><span style="color:#24292E;"> </span></span>
<span class="line diff add"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { toAccount } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;viem/accounts&#39;</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { mainnet } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;viem/chains&#39;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { getAddress, signMessage, signTransaction } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;./sign-utils&#39;</span><span style="color:#24292E;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">privateKey</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;0x...&#39;</span><span style="color:#24292E;"> </span></span>
<span class="line diff remove"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">account</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getAccount</span><span style="color:#24292E;">({ </span></span>
<span class="line diff add"><span style="color:#24292E;">const account </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">toAccount</span><span style="color:#24292E;">({ </span></span>
<span class="line"><span style="color:#24292E;">  address: </span><span style="color:#6F42C1;">getAddress</span><span style="color:#24292E;">(privateKey),</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">signMessage</span><span style="color:#24292E;">(</span><span style="color:#E36209;">message</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">signMessage</span><span style="color:#24292E;">(message, privateKey)</span></span>
<span class="line"><span style="color:#24292E;">  },</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">signTransaction</span><span style="color:#24292E;">(</span><span style="color:#E36209;">transaction</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">signTransaction</span><span style="color:#24292E;">(transaction, privateKey)</span></span>
<span class="line"><span style="color:#24292E;">  },</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">signTypedData</span><span style="color:#24292E;">(</span><span style="color:#E36209;">typedData</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">signTypedData</span><span style="color:#24292E;">(typedData, privateKey)</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"><span style="color:#24292E;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">const client </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">createWalletClient</span><span style="color:#24292E;">({</span></span>
<span class="line"><span style="color:#24292E;">  account,</span></span>
<span class="line"><span style="color:#24292E;">  chain: mainnet,</span></span>
<span class="line"><span style="color:#24292E;">  transport: </span><span style="color:#6F42C1;">http</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">})</span></span></code></pre></div><h3 id="在signmessage方法中重命名data" tabindex="-1">在<code>signMessage</code>方法中重命名<code>data</code> <a class="header-anchor" href="#在signmessage方法中重命名data" aria-label="Permalink to &quot;在\`signMessage\`方法中重命名\`data\`&quot;">​</a></h3><p>在<code>signMessage</code>方法中<code>data</code>被重命名为<code>message</code>。</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki github-dark has-diff vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">walletClient.</span><span style="color:#B392F0;">signMessage</span><span style="color:#E1E4E8;">({</span></span>
<span class="line diff remove"><span style="color:#E1E4E8;">  data: </span><span style="color:#9ECBFF;">&#39;hello world&#39;</span><span style="color:#E1E4E8;">, </span></span>
<span class="line diff add"><span style="color:#E1E4E8;">  message: </span><span style="color:#9ECBFF;">&#39;hello world&#39;</span><span style="color:#E1E4E8;">, </span></span>
<span class="line"><span style="color:#E1E4E8;">})</span></span></code></pre><pre class="shiki github-light has-diff vp-code-light"><code><span class="line"><span style="color:#24292E;">walletClient.</span><span style="color:#6F42C1;">signMessage</span><span style="color:#24292E;">({</span></span>
<span class="line diff remove"><span style="color:#24292E;">  data: </span><span style="color:#032F62;">&#39;hello world&#39;</span><span style="color:#24292E;">, </span></span>
<span class="line diff add"><span style="color:#24292E;">  message: </span><span style="color:#032F62;">&#39;hello world&#39;</span><span style="color:#24292E;">, </span></span>
<span class="line"><span style="color:#24292E;">})</span></span></code></pre></div>`,58),e=[o];function c(t,r,E,y,i,d){return n(),a("div",null,e)}const h=s(p,[["render",c]]);export{f as __pageData,h as default};
